<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>Tech Thoughts</title>
    <link>http://jmiguelr.github.io/</link>
    <atom:link href="/rss.xml" rel="self" type="application/rss+xml"/>
    
    <description></description>
    <pubDate>Sun, 19 Jan 2020 15:53:34 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>Getting Hyperfido U2F keys working on Linux (Ubuntu or Mint)</title>
      <link>http://jmiguelr.github.io/2020/01/19/Getting-Hyperfido-U2F-keys-working-on-Linux-Ubuntu-or-Mint/</link>
      <guid>http://jmiguelr.github.io/2020/01/19/Getting-Hyperfido-U2F-keys-working-on-Linux-Ubuntu-or-Mint/</guid>
      <pubDate>Sun, 19 Jan 2020 15:29:55 GMT</pubDate>
      <description>
      
        
        
          
        
      
      </description>
      
      <content:encoded><![CDATA[<p>I recently got a pair of cheap HyperFido keys. Some of them are <a href="https://www.amazon.es/HYPERSECU-HyperFIDO-Mini-U2F-Security/dp/B01LZO0WE9/ref=pd_sbs_107_t_0/262-8811488-2901814" target="_blank" rel="noopener">as cheap as 5,5€ on Amazon</a> but you can get others which maybe have better quality. Also, there are another keys which have support for bluethooh, NFC, and other features that can be very useful. </p><p>Anyway. That keys don’t work out of the box in Linux as they are not recognized as the proper hardware type by linux kernel, but the solution is very easy to implement.<br>I’m running right now 3 linux boxes with Linux Mint 18 and 19. </p><p>The solution, as I wrote, it’s really simple.  Just go to <code>/etc/udev/rules.d</code> (of course, as root) and create a file named <code>70-u2f.rules</code>. </p><p>Fill it with the following data:;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># this udev file should be used with udev 188 and newer</span><br><span class="line">ACTION!=&quot;add|change&quot;, GOTO=&quot;u2f_end&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># HyperSecu HyperFIDO</span><br><span class="line">KERNEL==&quot;hidraw*&quot;, SUBSYSTEM==&quot;hidraw&quot;, ATTRS&#123;idVendor&#125;==&quot;096e|2ccf&quot;, ATTRS&#123;idProduct&#125;==&quot;0880&quot;, TAG+=&quot;uaccess&quot;</span><br><span class="line"></span><br><span class="line">LABEL=&quot;u2f_end&quot;</span><br></pre></td></tr></table></figure><p>Some places write that only the 096e idVendor it’s needed. In my case the id is 2ccf (you can check it with <code>lsusb</code> command)</p><p>After creating the file, you can either reboot your computer or just execute <code>sudo udevadm control --reload-rules</code> </p><p>Some references:</p><p><a href="https://gist.github.com/quantenschaum/1426c93fe10fb8e5ed040100d6adfc7b" target="_blank" rel="noopener">https://gist.github.com/quantenschaum/1426c93fe10fb8e5ed040100d6adfc7b</a><br><a href="https://github.com/Yubico/libu2f-host/blob/master/70-u2f.rules" target="_blank" rel="noopener">https://github.com/Yubico/libu2f-host/blob/master/70-u2f.rules</a></p>]]></content:encoded>
      
      <comments>http://jmiguelr.github.io/2020/01/19/Getting-Hyperfido-U2F-keys-working-on-Linux-Ubuntu-or-Mint/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Show slow queries on postgresql</title>
      <link>http://jmiguelr.github.io/2019/09/13/Show-slow-queries-on-postgresql/</link>
      <guid>http://jmiguelr.github.io/2019/09/13/Show-slow-queries-on-postgresql/</guid>
      <pubDate>Fri, 13 Sep 2019 09:17:25 GMT</pubDate>
      <description>
      
        
        
          
        
      
      </description>
      
      <content:encoded><![CDATA[<p>In postgresql it’s pretty easy to show which queries can be optimized on<br>your application. Or, at least, which queries are more time consuming. </p><p>Just execute the following statement on your database</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER DATABASE myDatabase SET log_min_duration_statement = 5000;</span><br></pre></td></tr></table></figure><p>to show which queres takes more than 5 seconds. </p><p>Output will go to your postgresql system log. </p><p><a href="http://www.anchor.com.au/hosting/dedicated/Tuning_PostgreSQL_on_your_Dedicated_Server" target="_blank" rel="noopener">More information about Postgresql performance</a></p>]]></content:encoded>
      
      <comments>http://jmiguelr.github.io/2019/09/13/Show-slow-queries-on-postgresql/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Add a new ssh authorized key to a remote host... in one single line</title>
      <link>http://jmiguelr.github.io/2019/09/12/Add-a-new-ssh-authorized-key-to-a-remote-host-in-one-single-line/</link>
      <guid>http://jmiguelr.github.io/2019/09/12/Add-a-new-ssh-authorized-key-to-a-remote-host-in-one-single-line/</guid>
      <pubDate>Thu, 12 Sep 2019 16:06:25 GMT</pubDate>
      <description>
      
        
        
          
        
      
      </description>
      
      <content:encoded><![CDATA[<p>It’s a common task: “Please, add my public ssh key to that host”.</p><p>And I usually get the key, copied it to buffer, ssh to the remote host, cd .ssh and<br>finally I do a <code>cat - &gt;&gt; authorized_keys</code> and paste the key.</p><p>But you can do it in just one single line:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat new_key.pub | ssh myRemoteHost &quot;cat  &gt;&gt; ~/.ssh/authorized_keys&quot;</span><br></pre></td></tr></table></figure><p>That’s all!</p>]]></content:encoded>
      
      <comments>http://jmiguelr.github.io/2019/09/12/Add-a-new-ssh-authorized-key-to-a-remote-host-in-one-single-line/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Rename multiple files with a given pattern</title>
      <link>http://jmiguelr.github.io/2019/06/19/Rename-multiple-files-with-a-given-pattern/</link>
      <guid>http://jmiguelr.github.io/2019/06/19/Rename-multiple-files-with-a-given-pattern/</guid>
      <pubDate>Wed, 19 Jun 2019 08:52:35 GMT</pubDate>
      <description>
      
        
        
          
        
      
      </description>
      
      <content:encoded><![CDATA[<p>You may need to rename several files in a folder following a pattern.<br>Say you have </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">jmiguel@monk /tmp/a  $ touch file.1.txt</span><br><span class="line">jmiguel@monk /tmp/a  $ touch file.2.txt</span><br><span class="line">jmiguel@monk /tmp/a  $ touch file.3.txt</span><br><span class="line">jmiguel@monk /tmp/a  $ ll</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x  2 jmiguel jmiguel 4096 jun 19 10:54 .</span><br><span class="line">drwxrwxrwt 28 root    root    4096 jun 19 10:54 ..</span><br><span class="line">-rw-r--r--  1 jmiguel jmiguel    0 jun 19 10:54 file.1.txt</span><br><span class="line">-rw-r--r--  1 jmiguel jmiguel    0 jun 19 10:54 file.2.txt</span><br><span class="line">-rw-r--r--  1 jmiguel jmiguel    0 jun 19 10:54 file.3.txt</span><br></pre></td></tr></table></figure><p>And you want to get </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-rw-r--r--  1 jmiguel jmiguel    0 jun 19 10:54 newname.1.txt</span><br><span class="line">-rw-r--r--  1 jmiguel jmiguel    0 jun 19 10:54 newname.2.txt</span><br><span class="line">-rw-r--r--  1 jmiguel jmiguel    0 jun 19 10:54 newname.3.txt</span><br></pre></td></tr></table></figure><p>You can do a loop, string substitution… a mess. Or you can use the <code>rename</code> command in this way:</p><p><code>rename &#39;s/file/ppillo/g&#39; *</code></p><p>Note than rename is a shell script made with perl, so maybe it’s not available on your operating system (mint and ubuntu have it) but if you have perl you can just copy and paste de following code to create your own <code>rename</code> version.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"></span><br><span class="line">use strict;</span><br><span class="line">use File::Rename ();</span><br><span class="line">use Pod::Usage;</span><br><span class="line"></span><br><span class="line">main() unless caller;</span><br><span class="line"></span><br><span class="line">sub main &#123;</span><br><span class="line">    my $options = File::Rename::Options::GetOptions</span><br><span class="line">        or pod2usage;</span><br><span class="line"></span><br><span class="line">    mod_version() if $options-&gt;&#123;show_version&#125;;</span><br><span class="line">    pod2usage( -verbose =&gt; 2 ) if $options-&gt;&#123;show_manual&#125;;</span><br><span class="line">    pod2usage( -exitval =&gt; 1 ) if $options-&gt;&#123;show_help&#125;;</span><br><span class="line"></span><br><span class="line">    @ARGV = map &#123;glob&#125; @ARGV if $^O =~ m&#123;Win&#125;msx;</span><br><span class="line"></span><br><span class="line">    File::Rename::rename(\@ARGV, $options);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sub mod_version &#123;</span><br><span class="line">    print __FILE__ .</span><br><span class="line">  &apos; using File::Rename version &apos;.</span><br><span class="line">        $File::Rename::VERSION .&quot;\n\n&quot;;</span><br><span class="line">    exit 0</span><br><span class="line">&#125;   </span><br><span class="line"></span><br><span class="line">1;</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      <comments>http://jmiguelr.github.io/2019/06/19/Rename-multiple-files-with-a-given-pattern/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Copy thousand of files over ssh</title>
      <link>http://jmiguelr.github.io/2019/06/07/Copy-thousand-of-files-over-ssh/</link>
      <guid>http://jmiguelr.github.io/2019/06/07/Copy-thousand-of-files-over-ssh/</guid>
      <pubDate>Fri, 07 Jun 2019 07:01:49 GMT</pubDate>
      <description>
      
        
        
          
        
      
      </description>
      
      <content:encoded><![CDATA[<p>So… you have to copy several thousand of files and folders from one server to another. And you’re short of disk space, as usual, and you want to be as efficient as possible. </p><p>You can use <code>scp -r files user@server:/...</code> but if you do it this way you’ll notice it takes forever. This is because ssh/scp open and close a the stream for every file.  So you try to zip/tar in the <em>from</em> side to copy just one file, and then uncompress on the target side after copy. But this way you need roughtly twice as space in both sides. So, what can you do?. </p><h3 id="ssh-streams-to-the-rescue"><a href="#ssh-streams-to-the-rescue" class="headerlink" title="ssh streams to the rescue"></a>ssh streams to the rescue</h3><p>Maybe you know you can execute commands over ssh. If you do <code>ssh user@host ls</code> what you get it’s the <code>ls</code> on the remote side. Also, you also know there is a underlay stream which ssh uses, for example, in ssh tunnels.</p><p>So, how can you solve the original problem with this tool?.  Easy: create a tar file (maybe ever compressed) on the fly, pipe it through ssh and un-tar it on the other side. It’s MAGIC!  :-)</p><p>Copy from out local host to a remote:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -czf - [files] | ssh user@remoteHost &quot;tar -xzvf - -C /remote/desired/folder&quot;</span><br></pre></td></tr></table></figure><p>Read it:  create (c) as usual a tar file, compressed (z), and the file it’s the standard output (-).  Pipe it thru ssh to <em>remoteHost</em>, and there, execute a tar extract (x), also with compression (z), verbose to see what’s going on (v) with the standard input (-) comming from ssh stream. Change (-C) to the desired remote folder before starting the process on the remote side. </p><p>This is, AFAIK, the best way to do the jobs. Just one step, super-fast, using compression if needed… what else?</p><p>Of course, you can also do it reverse, from server to your host:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh user@remoteHost &quot;tar -cvf - /your/remote/folder&quot; | tar -xvf -</span><br></pre></td></tr></table></figure><p>You may even create a local tar file from remote files using this way:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh user@remoteHost &quot;tar -cvf - /your/remote/folder&quot; &gt; local.file.tgz</span><br></pre></td></tr></table></figure><p>Cool, isn’t it?</p>]]></content:encoded>
      
      <comments>http://jmiguelr.github.io/2019/06/07/Copy-thousand-of-files-over-ssh/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Setting default Linux kernel</title>
      <link>http://jmiguelr.github.io/2019/05/20/Setting-default-Linux-kernel/</link>
      <guid>http://jmiguelr.github.io/2019/05/20/Setting-default-Linux-kernel/</guid>
      <pubDate>Mon, 20 May 2019 14:34:12 GMT</pubDate>
      <description>
      
        
        
          
        
      
      </description>
      
      <content:encoded><![CDATA[<p>Sometimes we want to boot Linux with a older kernel than default. If it’s just one time, it’s a piece of cake to select it on the boot menu.</p><p>Things starts to get a bit worse if you need to boot everytime with a previous version because (as it’s my case right now) you suspect there’s something that could affect performance or stability but you’re not sure.</p><p>The best suited for my needs it’s telling <code>grub2</code> to remember the last kernel used. To do this you have to follow this steps:</p><ul><li>Keep a copy of <code>grub</code> file.  Just in case…</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /etc/default/grub /etc/default/grub.bak</span><br></pre></td></tr></table></figure><ul><li>Edit it with your favourite editor: vi, emacs, nano, joe …</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo joe /etc/default/grub</span><br></pre></td></tr></table></figure><p>and change the default behaviour <code>GRUB_DEFAULT=0</code> which cause grub to choose the latest kernel with:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GRUB_DEFAULT=saved</span><br><span class="line">GRUB_SAVEDEFAULT=true</span><br></pre></td></tr></table></figure><ul><li>Update grub with <code>sudo update-grub</code></li></ul><p>Done!</p>]]></content:encoded>
      
      <comments>http://jmiguelr.github.io/2019/05/20/Setting-default-Linux-kernel/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Changing hostname on Ubuntu 18.04 Server</title>
      <link>http://jmiguelr.github.io/2019/04/25/Changing-hostname-on-Ubuntu-18-04-Server/</link>
      <guid>http://jmiguelr.github.io/2019/04/25/Changing-hostname-on-Ubuntu-18-04-Server/</guid>
      <pubDate>Thu, 25 Apr 2019 11:18:50 GMT</pubDate>
      <description>
      
        
        
          
        
      
      </description>
      
      <content:encoded><![CDATA[<p>Coming from previous versions of Ubuntu, I’m getting some issues with the new configuration system on Ubuntu 18.04. Not sure if some of them are welcomed (to me) but…  they are there so we have no option.</p><p>Few moments ago, I’ve installed a new server with Ubuntu 18 and, thinking in future, I’ve created a blueprint on VMWare I could reuse for new servers. So I’ve create a new server with basic funcionalities, upgrade it and then convert to blueprint. Obviously, I gave it a nonsense name as <em>ubuntu18</em></p><p>After that, I created a virtual machine from blueprint and, you guess it, I tried to change the name.</p><p>On previous versiones, I just needed to change it on <code>/etc/hosts</code> and <code>/etc/hostname</code> . That’s all. But now we need an aditional step.  You need to change on <code>/etc/cloud/cloud.cfg</code> and tell you don’t want to upgrade the hostname (I could find where it finds the original name) on every reboot. The parameter is <code>preserve_hostname</code> and you need to change the default <code>false</code> value to <code>true</code></p><p>So all steps:</p><ul><li>Edit <code>/etc/cloud/cloud.cfg</code> and change <code>preserve_hostname: false</code> to <code>preserve_hostname: true</code></li><li>Edit <code>/etc/hostname</code> and <code>/etc/hosts</code> .  On <code>hostname</code> file, just put your new name. On <code>/etc/hosts</code>, add a line like <code>127.0.1.1 myHostName</code> and <code>x.x.x.x myHostName</code> where <code>x.x.x.x</code> it’s your real IP name (if static)</li></ul><p>That’s all!</p>]]></content:encoded>
      
      <comments>http://jmiguelr.github.io/2019/04/25/Changing-hostname-on-Ubuntu-18-04-Server/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Setting clock on ESXi console</title>
      <link>http://jmiguelr.github.io/2019/04/25/Setting-clock-on-ESXi-console/</link>
      <guid>http://jmiguelr.github.io/2019/04/25/Setting-clock-on-ESXi-console/</guid>
      <pubDate>Thu, 25 Apr 2019 09:28:17 GMT</pubDate>
      <description>
      
        
        
          
        
      
      </description>
      
      <content:encoded><![CDATA[<p>Today I realized one of my ESXi servers had system clock way long in the future. It has no internet access so I cannot simply update it with any of the multiple time servers around the world. I thought it was just a matter of simply do a <code>date -s</code> … but on ESXi console things are not usually so simpler.</p><p>The right way to change time on console involves two commands, one for current date and another for setting the hardware clock so you get the right date again after reboot.  Commands are:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># esxcli system time set -?</span><br><span class="line">Usage: esxcli system time set [cmd options]</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">  set                   Set the system clock time. Any missing parameters will default to the current time</span><br><span class="line"></span><br><span class="line">Cmd options:</span><br><span class="line">  -d|--day=&lt;long&gt;       Day</span><br><span class="line">  -H|--hour=&lt;long&gt;      Hour</span><br><span class="line">  -m|--min=&lt;long&gt;       Minute</span><br><span class="line">  -M|--month=&lt;long&gt;     Month</span><br><span class="line">  -s|--sec=&lt;long&gt;       Second</span><br><span class="line">  -y|--year=&lt;long&gt;      Year</span><br></pre></td></tr></table></figure><p>and</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">esxcli hardware clock set -?</span><br></pre></td></tr></table></figure><p>with the same format as above.</p><p>Note the <code>Any missing parameters will default to the current time</code>, I assume seconds go to zero when setting minutes, but it’s not the case here.</p><p>So, if you want to set time to 09:10:00 , current date, the right commands are:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># esxcli system time set -H 09 -m 10 -s 00  ; esxcli hardware clock set -H 09 -m 10 -s 00</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      <comments>http://jmiguelr.github.io/2019/04/25/Setting-clock-on-ESXi-console/#disqus_thread</comments>
    </item>
    
    <item>
      <title>The fastest way to count columns in shell: AWK</title>
      <link>http://jmiguelr.github.io/2019/02/03/The-fastest-way-to-count-columns-in-shell-AWK/</link>
      <guid>http://jmiguelr.github.io/2019/02/03/The-fastest-way-to-count-columns-in-shell-AWK/</guid>
      <pubDate>Sun, 03 Feb 2019 16:10:24 GMT</pubDate>
      <description>
      
        
        
          
        
      
      </description>
      
      <content:encoded><![CDATA[<p>Say you have (as I do) a file <code>/tmp/myFile.txt</code> containing a list of unrelated folders with their size, as follows:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">7220    X03066659D/txt/20150109</span><br><span class="line">1365    A30266659D/txt/20150112</span><br><span class="line">9       X30626659D/txt/20150121</span><br><span class="line">0       X30663659D/xml/20150102</span><br><span class="line">5292    A30646659D/xml/20150105</span><br><span class="line">10872   X30Q66659D/xml/20150107</span><br><span class="line">7384    A30A66659D/xml/20150108</span><br></pre></td></tr></table></figure><p>And you want to sum the first column of every line to know the total. <strong>AWK</strong> at rescue!</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &apos;&#123;sum += $1&#125; END &#123;print sum&#125; /tmp/myFile.txt&apos;</span><br></pre></td></tr></table></figure><p>If there were a discriminant you would like to use (imagine you only need those starting with <code>A</code> on second column) you can filter on AWK line (no need to grep)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &apos;$2 ~ /^A/ &#123;sum += $1&#125; END &#123;print sum&#125;&apos; /tmp/myFile.txt</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      <comments>http://jmiguelr.github.io/2019/02/03/The-fastest-way-to-count-columns-in-shell-AWK/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Restore whole folders from Amazon S3 Glacier</title>
      <link>http://jmiguelr.github.io/2019/01/05/Restore-whole-folders-from-Amazon-S3-Glacier/</link>
      <guid>http://jmiguelr.github.io/2019/01/05/Restore-whole-folders-from-Amazon-S3-Glacier/</guid>
      <pubDate>Sat, 05 Jan 2019 19:14:31 GMT</pubDate>
      <description>
      
        
        
          
        
      
      </description>
      
      <content:encoded><![CDATA[<p>Amazon Web Service it’s an incredible tool. And S3 it’s one of the best ways for storing your data and, of course, backups of your data. </p><p>If you use it for backup, you surely knows the Glacier feature: you can <em>freeze</em> your data getting a lower price… in money. Because the price you pay it’s that your data ain’t available immediatly when you need it, you have to wait to <em>restore</em> it before you can get it. </p><p>But a maybe worst issue is that you can’t restore a full folder. You only can restore files. So if you want to <em>un-Glacier</em> a folder you have to traverse all tree of folders, and check all individual files you want. One by one. </p><p>Althougt this sounds (and it is!) weird, it’s related with the way AWS S3 <em>sees</em> your files: there are no folders. A folder it’s just a visual representation of structure of files (using / as separator). But for S3 <strong>everything</strong> is a file.</p><p>Said that: I needed to restore a full directory with a lot of directories so doing the job one by one wasn’t an option. So I came to <a href="https://stackoverflow.com/questions/20033651/how-to-restore-folders-or-entire-buckets-to-amazon-s3-from-glacier" target="_blank" rel="noopener">this solution on stackOverflow</a> with credits to <a href="http://capnjosh.com/blog/a-client-error-invalidobjectstate-occurred-when-calling-the-copyobject-operation-operation-is-not-valid-for-the-source-objects-storage-class/" target="_blank" rel="noopener">this other blog post</a>. </p><p>I’ve modified the script just a bit because it didn’t work for me (maybe some parameters of aws-cli have changed).  You’ll need the aws cli (Command Line Interface) to do this. </p><p>First of all, we get all <em>Glaciered</em> items on a bucket named here MYBUCKET, substitute it with your own name<br>(please note: I’ve updated it to allow spaces on file or folder names):</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aws s3api list-objects-v2 --bucket MYBUCKET --query &quot;Contents[?StorageClass==&apos;GLACIER&apos;]&quot; --output text | awk &apos;&#123;print substr($0, index($0, $2))&#125;&apos; | awk &apos;&#123;NF-=3&#125;;3&apos; &gt; glacier-restore.txt</span><br></pre></td></tr></table></figure><p>This will get a list with all objects under Glacier rules on your bucket. Maybe you don’t want all of them so this is the moment to edit the <code>glacier-restore.txt</code> file in case you want to fine-tune the files you want to get. </p><p>Then, create (edit + chmod 755) the following script which takes the content of your file an do the restore:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line">cat glacier-restore.txt   | while read x</span><br><span class="line">  do</span><br><span class="line">    echo &quot;Begin restoring $x&quot;</span><br><span class="line">    aws s3api restore-object --restore-request Days=25 --bucket MYBUCKET --key &quot;$x&quot;</span><br><span class="line">    echo &quot;Done restoring $x&quot;</span><br><span class="line">  done</span><br></pre></td></tr></table></figure><p>Remember: the process it’s not inmediate. With this command you instruct AWS to restore your files, but it will take between 3 and 5 hours to complete.  You can do it faster (and more expensive) but if you need it so fast you’d maybe should consider standard storage. </p><p>Hope this helps!</p>]]></content:encoded>
      
      <comments>http://jmiguelr.github.io/2019/01/05/Restore-whole-folders-from-Amazon-S3-Glacier/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Undo a pushed commit on git</title>
      <link>http://jmiguelr.github.io/2018/11/28/Undo-a-pushed-commit-on-git/</link>
      <guid>http://jmiguelr.github.io/2018/11/28/Undo-a-pushed-commit-on-git/</guid>
      <pubDate>Wed, 28 Nov 2018 10:08:49 GMT</pubDate>
      <description>
      
        
        
          
        
      
      </description>
      
      <content:encoded><![CDATA[<p>We all know it. Shit happens.</p><p>Today, I screw a small piece of code ( thank you SonarLint! ;-) (*)).  It was just a small optimization, but after checking with a coworker the code we couldn’t find what was going wrong but the reality was that something was broken so I decided to go back in time.</p><p>The commits (2 commits) was already pushed to our bitbucket and tried several approaches. I created a detached branch, modify and commit. No success. Then I tried some of features IntelliJ gaves me, but I could find a good one.</p><p>So finally I found (<a href="https://stackoverflow.com/questions/4114095/how-to-revert-a-git-repository-to-a-previous-commit" target="_blank" rel="noopener">stackoverflow at rescue</a>) this solution which help <strong>in my case</strong>.  Be careful: my problem may be different than yours and so the solution. Even more, the solution I used it’s not the choosen as the best on previous link.</p><p>I had the following git history</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">commit 2071cf3cb8</span><br><span class="line">Author: xxxxx</span><br><span class="line">Date:   Wed Nov 28 10:16:48 2018 +0100</span><br><span class="line"></span><br><span class="line">commit 5ff2c4a3a1</span><br><span class="line">Author: xxxxx</span><br><span class="line">Date:   Wed Nov 28 10:11:06 2018 +0100</span><br><span class="line"></span><br><span class="line">commit 3a37cbc8e7</span><br><span class="line">Author: yyyyy</span><br><span class="line">Date:   Wed Nov 28 09:58:33 2018 +0100</span><br></pre></td></tr></table></figure><p>The two top commits was mine, and was wrong. I wanted to go back to 3a37cbc8e7 so I use the following sequence:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Resets index to former commit; replace &apos;3a37cbc8e7&apos; with your commit code</span><br><span class="line">git reset 3a37cbc8e7</span><br><span class="line"></span><br><span class="line"># Moves pointer back to previous HEAD</span><br><span class="line">git reset --soft HEAD@&#123;1&#125;</span><br><span class="line"></span><br><span class="line">git commit -m &quot;Revert commit to the past&quot;</span><br><span class="line"></span><br><span class="line"># Updates working copy to reflect the new commit</span><br><span class="line">git reset --hard</span><br></pre></td></tr></table></figure><p>Here is the point where you’re back to the commit you wanted to be. Check it. If you’re satisfied, just push it.</p><p>And additional benefit with this approach is that you don’t loose your history: there will be ever a culprit (myself, in this case) written on the chain.</p><p>Hope this helps.</p><p>(*) PS: Of course, the blame on SonarLint it’s just a joke. The fault was mine :-)</p>]]></content:encoded>
      
      <comments>http://jmiguelr.github.io/2018/11/28/Undo-a-pushed-commit-on-git/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Convert file encoding, bulk way</title>
      <link>http://jmiguelr.github.io/2018/11/20/Convert-file-encoding-bulk-way/</link>
      <guid>http://jmiguelr.github.io/2018/11/20/Convert-file-encoding-bulk-way/</guid>
      <pubDate>Tue, 20 Nov 2018 11:36:45 GMT</pubDate>
      <description>
      
        
        
          
        
      
      </description>
      
      <content:encoded><![CDATA[<p>I have an old java project, with all files enconded as ISO-8859-1 . It was made back in time where most of our development team worked with Windows (fortunately, those times are over ;-)).  Now (almost 10 years later -yep that is a really <strong>legacy</strong> project-) we’re updating it, mostly in the frontend user interface.</p><p>So, when we started working with it we had a mix of old ISO-8859-1 files and new UTF-8. At some point we decided to change all files encoding to UTF-8. We made some changes using the IntelliJ features for this purpose but it was clear we needed some automatized way to do it, and this is the one-liner way we used:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find -type f -name &quot;*.java&quot; -exec file &#123;&#125; \; | grep ISO | cut -d &quot;:&quot; -f 1  | while read a ; do iconv -f ISO-8859-1 -t UTF-8 &lt; $a &gt; /tmp/tmp ; &quot;mv&quot; /tmp/tmp $a ; done</span><br></pre></td></tr></table></figure><p>So read it as follows:</p><p>“Find all java files, check which of them are encoded as <em>ISO-whatever</em> and for all of them use the <code>iconv</code> command to create a new correctly encoded file as <code>/tmp/tmp</code> and then move it to the original location”</p><p>Of course: change the <em>“.java”</em> for whatever you need, and maybe it’s a good idea to run it in several steps to see what’s happening.</p><p>Run first just the <code>find -type f -name &quot;*.java&quot; -exec file {} \; | grep ISO</code> , then something like <code>find -type f -name &quot;*.java&quot; -exec file {} \; | grep ISO | cut -d &quot;:&quot; -f 1  | while read a ; echo &quot;gonna work with $a&quot; ; done</code> so you can be sure you don’t break anything (make a backup first!)</p>]]></content:encoded>
      
      <comments>http://jmiguelr.github.io/2018/11/20/Convert-file-encoding-bulk-way/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Error actualizando docker (mint 18)</title>
      <link>http://jmiguelr.github.io/2018/11/12/Error-actualizando-docker-mint-18/</link>
      <guid>http://jmiguelr.github.io/2018/11/12/Error-actualizando-docker-mint-18/</guid>
      <pubDate>Mon, 12 Nov 2018 14:58:40 GMT</pubDate>
      <description>
      
        
        
          
        
      
      </description>
      
      <content:encoded><![CDATA[<p>Hoy, actualizando el sistema desde el entorno gráfico, me ha salido un error de un paquete que no podía actualizar. El sistema me sugería que buscara cual era el paquete que daba problemas usando el filtro <em>rotos</em> .  Tras maldecirme por hacer estas cosas en el entorno gráfico en lugar de la consola, he ejecutado <code>sudo apt-get update &amp;&amp; sudo apt-get upgrade</code> desde la consola para ver que es lo que estaba pasando realmente.</p><p>El resultado era:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Los siguientes paquetes tienen dependencias incumplidas:</span><br><span class="line"> docker-ce : Depende: containerd.io pero no está instalado</span><br><span class="line">E: Dependencias incumplidas. Pruebe de nuevo utilizando -f.</span><br><span class="line">jmiguel@mab ~  $ sudo apt-get -f install</span><br><span class="line">Leyendo lista de paquetes... Hecho</span><br><span class="line">Creando árbol de dependencias</span><br><span class="line">Leyendo la información de estado... Hecho</span><br><span class="line">Corrigiendo dependencias... Listo</span><br><span class="line">Los paquetes indicados a continuación se instalaron de forma automática y ya no son necesarios.</span><br><span class="line">  libjs-openlayers libwireshark8 libwiretap6 libwscodecs1 libwsutil7</span><br><span class="line">Utilice «sudo apt autoremove» para eliminarlos.</span><br><span class="line">Se instalarán los siguientes paquetes adicionales:</span><br><span class="line">  containerd.io</span><br><span class="line">Se instalarán los siguientes paquetes NUEVOS:</span><br><span class="line">  containerd.io</span><br><span class="line">0 actualizados, 1 nuevos se instalarán, 0 para eliminar y 0 no actualizados.</span><br><span class="line">1 no instalados del todo o eliminados.</span><br><span class="line">Se necesita descargar 0 B/19,9 MB de archivos.</span><br><span class="line">Se utilizarán 87,6 MB de espacio de disco adicional después de esta operación.</span><br><span class="line">¿Desea continuar? [S/n] S</span><br><span class="line">(Leyendo la base de datos ... 523472 ficheros o directorios instalados actualmente.)</span><br><span class="line">Preparando para desempaquetar .../containerd.io_1.2.0-1_amd64.deb ...</span><br><span class="line">Desempaquetando containerd.io (1.2.0-1) ...</span><br><span class="line">dpkg: error al procesar el archivo /var/cache/apt/archives/containerd.io_1.2.0-1_amd64.deb (--unpack):</span><br><span class="line"> intentando sobreescribir `/usr/sbin/runc&apos;, que está también en el paquete runc 1.0.0~rc2+docker1.13.1-0ubuntu1~16.04.1</span><br><span class="line">dpkg-deb: error: el subproceso copiado fue terminado por la señal (Broken pipe)</span><br><span class="line">Se encontraron errores al procesar:</span><br><span class="line"> /var/cache/apt/archives/containerd.io_1.2.0-1_amd64.deb</span><br></pre></td></tr></table></figure><p>Parece que había algun problema con la actulizacion de docker. He probado a parar docker antes de actualizar pero el resultado era el mismo, asi que la solución ha sido desinstalar <code>docker-ce</code> y  <code>runc</code> , que parece ser antiguo y estar obsoleto.</p><p>Asi que tras ejecutar:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get remove docker-ce</span><br><span class="line">sudo apt-get remove runc</span><br><span class="line">sudo apt-get install docker-ce</span><br></pre></td></tr></table></figure><p>Todo ha vuelto a la normalidad.</p><p>Espero que a alguien le sirva :-)</p>]]></content:encoded>
      
      <comments>http://jmiguelr.github.io/2018/11/12/Error-actualizando-docker-mint-18/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Several submit actions in one form</title>
      <link>http://jmiguelr.github.io/2018/10/22/Several-submit-actions-in-one-form/</link>
      <guid>http://jmiguelr.github.io/2018/10/22/Several-submit-actions-in-one-form/</guid>
      <pubDate>Mon, 22 Oct 2018 20:18:58 GMT</pubDate>
      <description>
      
        
        
          
        
      
      </description>
      
      <content:encoded><![CDATA[<p>Sometimes you need to have several actions to be submitted on the same form. Usually you only have one button for this which points to the place you define on the <code>FORM ACTION</code> block.<br>So, how can you detect which button was clicked in plain HTML?</p><p>You can use the <code>value</code> variable on button, this way:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;FORM METHOD=&quot;whatever&quot; ACTION=&quot;/your/endPoint/&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;button name=&quot;btnaction&quot; value=&quot;accept&quot; class=&quot;...&quot; type=&quot;submit&quot;&gt;Accept 1&lt;/button&gt;&quot;</span><br><span class="line">&lt;button name=&quot;btnaction&quot; value=&quot;dontAccept&quot; class=&quot;...&quot; type=&quot;submit&quot;&gt;Dont Accept&lt;/button&gt;&quot;</span><br><span class="line">&lt;button name=&quot;btnaction&quot; value=&quot;maybe&quot; class=&quot;...&quot; type=&quot;submit&quot;&gt;Maybe Accept&lt;/button&gt;&quot;</span><br></pre></td></tr></table></figure><p>And in your code just check the <code>btnAction</code> parameter variable for <code>accept</code>, <code>dontAccept</code> or <code>maybe</code> values.  Easy!</p>]]></content:encoded>
      
      <comments>http://jmiguelr.github.io/2018/10/22/Several-submit-actions-in-one-form/#disqus_thread</comments>
    </item>
    
    <item>
      <title>Show block id on Linux devices</title>
      <link>http://jmiguelr.github.io/2018/09/18/Show-block-id-on-Linux-devices/</link>
      <guid>http://jmiguelr.github.io/2018/09/18/Show-block-id-on-Linux-devices/</guid>
      <pubDate>Tue, 18 Sep 2018 09:01:27 GMT</pubDate>
      <description>
      
        
        
          
        
      
      </description>
      
      <content:encoded><![CDATA[<p>This is the kind of things I have to seach everytime I need to install a new drive on a computer. As this is the kind of things I don’t do everyday, I forget it. </p><p>So… How list the devices IDs on a Linux system?. Just like this:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@caronte:~# blkid</span><br><span class="line">/dev/sda1: UUID=&quot;d5a0a58e-13bc-46bb-b106-de5219dd7259&quot; TYPE=&quot;ext4&quot; PARTUUID=&quot;92e8992d-01&quot;</span><br><span class="line">/dev/sda2: UUID=&quot;14fa763f-0861-41c3-ba52-ce25e94e009a&quot; TYPE=&quot;ext4&quot; PARTUUID=&quot;92e8992d-02&quot;</span><br><span class="line">/dev/sdb1: UUID=&quot;5bd7c629-74af-4714-b3f6-34bab7a988b0&quot; TYPE=&quot;ext4&quot; PARTUUID=&quot;dd4daff0-c29a-4489-ab93-06e3929e2cad&quot;</span><br><span class="line">/dev/sdc1: UUID=&quot;42123f82-e997-46b6-9dc7-d1d7f521379f&quot; TYPE=&quot;ext4&quot; PARTUUID=&quot;151b9380-01&quot;</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      <comments>http://jmiguelr.github.io/2018/09/18/Show-block-id-on-Linux-devices/#disqus_thread</comments>
    </item>
    
    <item>
      <title>My Hello World</title>
      <link>http://jmiguelr.github.io/2018/09/06/first-post/</link>
      <guid>http://jmiguelr.github.io/2018/09/06/first-post/</guid>
      <pubDate>Thu, 06 Sep 2018 21:50:56 GMT</pubDate>
      <description>
      
        
        
          
        
      
      </description>
      
      <content:encoded><![CDATA[<p>Welcome to my brand new blog!. </p><p>As I pretend to write about technologies I use, I cannot imagine a better way to start:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> _   _      _ _        __        __         _     _ </span><br><span class="line">| | | | ___| | | ___   \ \      / /__  _ __| | __| |</span><br><span class="line">| |_| |/ _ \ | |/ _ \   \ \ /\ / / _ \| &apos;__| |/ _` |</span><br><span class="line">|  _  |  __/ | | (_) |   \ V  V / (_) | |  | | (_| |</span><br><span class="line">|_| |_|\___|_|_|\___/     \_/\_/ \___/|_|  |_|\__,_|</span><br></pre></td></tr></table></figure><h3 id="Disclaimer"><a href="#Disclaimer" class="headerlink" title="Disclaimer:"></a>Disclaimer:</h3><p>I’m a non-english speaker. My spoken english is far to be fluent but I think I can make a good job trying to write it. And it should improve on future, as it’s part of what I want ot do with this new blog. </p><h3 id="What-can-you-find-here"><a href="#What-can-you-find-here" class="headerlink" title="What can you find here?"></a>What can you find here?</h3><p>I’ve been programmer (gwBasic, Clipper, Visual Basic, Perl, Java, Groovy) and systems analyst (or SysOp, SysAdmin, BOFH or whatever you want) since 1985. So I’ll write to whatever I find interesting but always related to technical questions. I have <a href="https://blog.jmiguel.eu" target="_blank" rel="noopener">other blog</a> for personal questions and for some time (maybe some day…) I had another one for aviation information: <a href="http://www.aerotrastornados.com" target="_blank" rel="noopener">aerotrastornados.com</a></p><h3 id="Tagging"><a href="#Tagging" class="headerlink" title="Tagging"></a>Tagging</h3><p>All posts will have some tags. First for language [eng <strong>|</strong> esp]. Next for topic, and I’ll try to keep the list as short as possible: [programming <strong>|</strong> systems <strong>|</strong> java <strong>|</strong> groovy <strong>|</strong> grails <strong>|</strong> linux]</p><p>No more to write right now. Just let’s see if I can publish it without further problems before start customization, fonts, images and so on. </p>]]></content:encoded>
      
      <comments>http://jmiguelr.github.io/2018/09/06/first-post/#disqus_thread</comments>
    </item>
    
  </channel>
</rss>
