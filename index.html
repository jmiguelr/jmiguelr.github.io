<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Tech Thoughts</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Tech Thoughts">
<meta property="og:url" content="http://jmiguelr.github.io/index.html">
<meta property="og:site_name" content="Tech Thoughts">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="jmiguel rodriguez">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@jmiguel">
  
    <link rel="alternate" href="/rss.xml" title="Tech Thoughts" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Tech Thoughts</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">A blog with my opinions and thoughts on technology</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="https://www.jmiguel.eu" target="_blank" rel="noopener">jmiguel.eu</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/rss.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://jmiguelr.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-My-new-2FA-setup-Authy-oathtool" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/01/02/My-new-2FA-setup-Authy-oathtool/" class="article-date">
  <time datetime="2021-01-02T10:23:58.000Z" itemprop="datePublished">2021-01-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/01/02/My-new-2FA-setup-Authy-oathtool/">My new 2FA setup - Authy + oathtool</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>So long!.  I know, 2020 has been such a strange year. For me, it also was the first time (yes, in my life) I switched to another company. Coming from being self-employed on my own company, it was a great change but I’m really happy about that change. Even I’ve been forced to keep my mind fully in focus for work. </p>
<p>Anyway: I want to talk about my new security setup for internet applications. I had some spare time and a huge To-Do list but this was one of my top priorities. I’ve been using 2-factor authentication (2FA) for some time with the <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=es&gl=US" target="_blank" rel="noopener">Google Authenticator</a> android application.  But I was not fully satisfied with it. </p>
<p>Sometimes I want to authenticate on desktop applications and I’d like to be able to do it from my computer. But I’d also like to be in sync with the phone application. Or just be free to know the seed for any service I use to feel it as <em>mine</em> (I could reuse the bitcoin <em>motto</em> “not your keys, not your coins” here).</p>
<p>Also, I was using the <a href="https://jmiguelr.github.io/2020/01/19/Getting-Hyperfido-U2F-keys-working-on-Linux-Ubuntu-or-Mint/">HyperFido keys I wrote about</a> in just two places, so I wanted to extend the use. </p>
<p>So: first move was to find a replacement for the mobile app with enough freedom and I choose <a href="https://authy.com/" target="_blank" rel="noopener">Authy</a>. It also has some cloud sync utilities I don’t plan to use. I just want to keep my seeds for the sites I use (and also a good improvement: password protected beyond the mobile protection). </p>
<p>Second: find a way to get the 2FA tokens (One-Time Passwords, OTP) on Linux. As easy as <code>sudo apt install oathtool</code> . With this small tool you can get your One-Time Passwords easily. </p>
<p>So, the final step was going for every important service I use and change the security setup. Some of them (Firefox, Dropbox) forces you to remove all 2FA previous setup before starts with a new one. Others (Google) will let you change only what you need (so you don’t need to re-register your Fido keys if you just want to change your OTP setup).</p>
<p>In all the cases the procedure is very similar: the site you register will allow you both scans a QR-code or manually enter a chain of letters (usually 6 groups of 4 letters each, sometimes more or fewer letters).  This is your seed for that site. Keep it safe and secret (my choice is to save it on keepass, together with the real password for that site).  </p>
<p>Now you can use that string on Authy to add your site on your mobile device. Even while Authy has that option, I prefer not to upload my seeds to their cloud, but it’s up to you. I understand it’s a good way to have the codes in sync for several devices, or just for having a backup of the seeds, but I don’t need it (and I don’t like it)</p>
<p>And of course, the last piece for having generated OTP on Linux is <code>oathtool</code> on command line. Just type </p>
<pre><code>oathtool --base32 --totp abcdefghijklmnopqrstuvwxyz</code></pre><p>(obviously, with your real seed code) to get the OTP you need to login. </p>
<p>Is this a perfect solution?. For sure, It isn’t. I’m not fully satisfied having in the same place both the password for the site and the 2AF seed. I could have two keepass different files but I don’t feel it as a need right now. </p>
<p>Also: I’m using this OTP system as a backup for the preferred 2FA way: the physical Fido keys. After almost one year of using them I can conclude they are a very good way to get authenticated. I own 2 Fido keys so I can have one of them always with me and the other on a safe place as backup. Not every site allows to have several keys (cannot understand why, I hope it will eventually fix it)</p>
<p>Well, that’s all!.  I hope this system for keeping your accounts more secure helps you.  As long as right now there’s no comments system available for this site, tell me whatever you think about this setup via Twitter: <a href="https://twitter.com/jmiguel" target="_blank" rel="noopener">@jmiguel</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jmiguelr.github.io/2021/01/02/My-new-2FA-setup-Authy-oathtool/" data-id="ckjfn7ck20004wqd98dmnear9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/eng/" rel="tag">eng</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Getting-Hyperfido-U2F-keys-working-on-Linux-Ubuntu-or-Mint" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/01/19/Getting-Hyperfido-U2F-keys-working-on-Linux-Ubuntu-or-Mint/" class="article-date">
  <time datetime="2020-01-19T15:29:55.000Z" itemprop="datePublished">2020-01-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/01/19/Getting-Hyperfido-U2F-keys-working-on-Linux-Ubuntu-or-Mint/">Getting Hyperfido U2F keys working on Linux (Ubuntu or Mint)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>I recently got a pair of cheap HyperFido keys. Some of them are <a href="https://www.amazon.es/HYPERSECU-HyperFIDO-Mini-U2F-Security/dp/B01LZO0WE9/ref=pd_sbs_107_t_0/262-8811488-2901814" target="_blank" rel="noopener">as cheap as 5,5€ on Amazon</a> but you can get others which maybe have better quality. Also, there are another keys which have support for bluethooh, NFC, and other features that can be very useful. </p>
<p>Anyway. That keys don’t work out of the box in Linux as they are not recognized as the proper hardware type by linux kernel, but the solution is very easy to implement.<br>I’m running right now 3 linux boxes with Linux Mint 18 and 19. </p>
<p>The solution, as I wrote, it’s really simple.  Just go to <code>/etc/udev/rules.d</code> (of course, as root) and create a file named <code>70-u2f.rules</code>. </p>
<p>Fill it with the following data:;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># this udev file should be used with udev 188 and newer</span><br><span class="line">ACTION!&#x3D;&quot;add|change&quot;, GOTO&#x3D;&quot;u2f_end&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># HyperSecu HyperFIDO</span><br><span class="line">KERNEL&#x3D;&#x3D;&quot;hidraw*&quot;, SUBSYSTEM&#x3D;&#x3D;&quot;hidraw&quot;, ATTRS&#123;idVendor&#125;&#x3D;&#x3D;&quot;096e|2ccf&quot;, ATTRS&#123;idProduct&#125;&#x3D;&#x3D;&quot;0880&quot;, TAG+&#x3D;&quot;uaccess&quot;</span><br><span class="line"></span><br><span class="line">LABEL&#x3D;&quot;u2f_end&quot;</span><br></pre></td></tr></table></figure>

<p>Some places write that only the 096e idVendor it’s needed. In my case the id is 2ccf (you can check it with <code>lsusb</code> command)</p>
<p>After creating the file, you can either reboot your computer or just execute <code>sudo udevadm control --reload-rules</code> </p>
<p>Some references:</p>
<p><a href="https://gist.github.com/quantenschaum/1426c93fe10fb8e5ed040100d6adfc7b" target="_blank" rel="noopener">https://gist.github.com/quantenschaum/1426c93fe10fb8e5ed040100d6adfc7b</a><br><a href="https://github.com/Yubico/libu2f-host/blob/master/70-u2f.rules" target="_blank" rel="noopener">https://github.com/Yubico/libu2f-host/blob/master/70-u2f.rules</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jmiguelr.github.io/2020/01/19/Getting-Hyperfido-U2F-keys-working-on-Linux-Ubuntu-or-Mint/" data-id="ckjfn7ck9000cwqd93uwk1i7v" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/eng/" rel="tag">eng</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Show-slow-queries-on-postgresql" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/13/Show-slow-queries-on-postgresql/" class="article-date">
  <time datetime="2019-09-13T09:17:25.000Z" itemprop="datePublished">2019-09-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/09/13/Show-slow-queries-on-postgresql/">Show slow queries on postgresql</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>In postgresql it’s pretty easy to show which queries can be optimized on<br>your application. Or, at least, which queries are more time consuming. </p>
<p>Just execute the following statement on your database</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER DATABASE myDatabase SET log_min_duration_statement &#x3D; 5000;</span><br></pre></td></tr></table></figure>

<p>to show which queres takes more than 5 seconds. </p>
<p>Output will go to your postgresql system log. </p>
<p><a href="http://www.anchor.com.au/hosting/dedicated/Tuning_PostgreSQL_on_your_Dedicated_Server" target="_blank" rel="noopener">More information about Postgresql performance</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jmiguelr.github.io/2019/09/13/Show-slow-queries-on-postgresql/" data-id="ckjfn7ckl000wwqd99tob92rt" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/eng/" rel="tag">eng</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Add-a-new-ssh-authorized-key-to-a-remote-host-in-one-single-line" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/09/12/Add-a-new-ssh-authorized-key-to-a-remote-host-in-one-single-line/" class="article-date">
  <time datetime="2019-09-12T16:06:25.000Z" itemprop="datePublished">2019-09-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/09/12/Add-a-new-ssh-authorized-key-to-a-remote-host-in-one-single-line/">Add a new ssh authorized key to a remote host... in one single line</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>It’s a common task: “Please, add my public ssh key to that host”.</p>
<p>And I usually get the key, copied it to buffer, ssh to the remote host, cd .ssh and<br>finally I do a <code>cat - &gt;&gt; authorized_keys</code> and paste the key.</p>
<p>But you can do it in just one single line:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat new_key.pub | ssh myRemoteHost &quot;cat  &gt;&gt; ~&#x2F;.ssh&#x2F;authorized_keys&quot;</span><br></pre></td></tr></table></figure>

<p>That’s all!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jmiguelr.github.io/2019/09/12/Add-a-new-ssh-authorized-key-to-a-remote-host-in-one-single-line/" data-id="ckjfn7cjq0000wqd94in1481u" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/eng/" rel="tag">eng</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Rename-multiple-files-with-a-given-pattern" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/19/Rename-multiple-files-with-a-given-pattern/" class="article-date">
  <time datetime="2019-06-19T08:52:35.000Z" itemprop="datePublished">2019-06-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/19/Rename-multiple-files-with-a-given-pattern/">Rename multiple files with a given pattern</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>You may need to rename several files in a folder following a pattern.<br>Say you have </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">jmiguel@monk &#x2F;tmp&#x2F;a  $ touch file.1.txt</span><br><span class="line">jmiguel@monk &#x2F;tmp&#x2F;a  $ touch file.2.txt</span><br><span class="line">jmiguel@monk &#x2F;tmp&#x2F;a  $ touch file.3.txt</span><br><span class="line">jmiguel@monk &#x2F;tmp&#x2F;a  $ ll</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x  2 jmiguel jmiguel 4096 jun 19 10:54 .</span><br><span class="line">drwxrwxrwt 28 root    root    4096 jun 19 10:54 ..</span><br><span class="line">-rw-r--r--  1 jmiguel jmiguel    0 jun 19 10:54 file.1.txt</span><br><span class="line">-rw-r--r--  1 jmiguel jmiguel    0 jun 19 10:54 file.2.txt</span><br><span class="line">-rw-r--r--  1 jmiguel jmiguel    0 jun 19 10:54 file.3.txt</span><br></pre></td></tr></table></figure>


<p>And you want to get </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-rw-r--r--  1 jmiguel jmiguel    0 jun 19 10:54 newname.1.txt</span><br><span class="line">-rw-r--r--  1 jmiguel jmiguel    0 jun 19 10:54 newname.2.txt</span><br><span class="line">-rw-r--r--  1 jmiguel jmiguel    0 jun 19 10:54 newname.3.txt</span><br></pre></td></tr></table></figure>

<p>You can do a loop, string substitution… a mess. Or you can use the <code>rename</code> command in this way:</p>
<p><code>rename &#39;s/file/ppillo/g&#39; *</code></p>
<p>Note than rename is a shell script made with perl, so maybe it’s not available on your operating system (mint and ubuntu have it) but if you have perl you can just copy and paste de following code to create your own <code>rename</code> version.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">#</span><br><span class="line"></span><br><span class="line">use strict;</span><br><span class="line">use File::Rename ();</span><br><span class="line">use Pod::Usage;</span><br><span class="line"></span><br><span class="line">main() unless caller;</span><br><span class="line"></span><br><span class="line">sub main &#123;</span><br><span class="line">    my $options &#x3D; File::Rename::Options::GetOptions</span><br><span class="line">        or pod2usage;</span><br><span class="line"></span><br><span class="line">    mod_version() if $options-&gt;&#123;show_version&#125;;</span><br><span class="line">    pod2usage( -verbose &#x3D;&gt; 2 ) if $options-&gt;&#123;show_manual&#125;;</span><br><span class="line">    pod2usage( -exitval &#x3D;&gt; 1 ) if $options-&gt;&#123;show_help&#125;;</span><br><span class="line"></span><br><span class="line">    @ARGV &#x3D; map &#123;glob&#125; @ARGV if $^O &#x3D;~ m&#123;Win&#125;msx;</span><br><span class="line"></span><br><span class="line">    File::Rename::rename(\@ARGV, $options);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sub mod_version &#123;</span><br><span class="line">    print __FILE__ .</span><br><span class="line">  &#39; using File::Rename version &#39;.</span><br><span class="line">        $File::Rename::VERSION .&quot;\n\n&quot;;</span><br><span class="line">    exit 0</span><br><span class="line">&#125;   </span><br><span class="line"></span><br><span class="line">1;</span><br></pre></td></tr></table></figure>



      
    </div>
    <footer class="article-footer">
      <a data-url="http://jmiguelr.github.io/2019/06/19/Rename-multiple-files-with-a-given-pattern/" data-id="ckjfn7ckc000hwqd91fs0f3e5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/eng/" rel="tag">eng</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Copy-thousand-of-files-over-ssh" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/06/07/Copy-thousand-of-files-over-ssh/" class="article-date">
  <time datetime="2019-06-07T07:01:49.000Z" itemprop="datePublished">2019-06-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/06/07/Copy-thousand-of-files-over-ssh/">Copy thousand of files over ssh</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>So… you have to copy several thousand of files and folders from one server to another. And you’re short of disk space, as usual, and you want to be as efficient as possible. </p>
<p>You can use <code>scp -r files user@server:/...</code> but if you do it this way you’ll notice it takes forever. This is because ssh/scp open and close a the stream for every file.  So you try to zip/tar in the <em>from</em> side to copy just one file, and then uncompress on the target side after copy. But this way you need roughtly twice as space in both sides. So, what can you do?. </p>
<h3 id="ssh-streams-to-the-rescue"><a href="#ssh-streams-to-the-rescue" class="headerlink" title="ssh streams to the rescue"></a>ssh streams to the rescue</h3><p>Maybe you know you can execute commands over ssh. If you do <code>ssh user@host ls</code> what you get it’s the <code>ls</code> on the remote side. Also, you also know there is a underlay stream which ssh uses, for example, in ssh tunnels.</p>
<p>So, how can you solve the original problem with this tool?.  Easy: create a tar file (maybe ever compressed) on the fly, pipe it through ssh and un-tar it on the other side. It’s MAGIC!  :-)</p>
<p>Copy from out local host to a remote:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -czf - [files] | ssh user@remoteHost &quot;tar -xzvf - -C &#x2F;remote&#x2F;desired&#x2F;folder&quot;</span><br></pre></td></tr></table></figure>

<p>Read it:  create (c) as usual a tar file, compressed (z), and the file it’s the standard output (-).  Pipe it thru ssh to <em>remoteHost</em>, and there, execute a tar extract (x), also with compression (z), verbose to see what’s going on (v) with the standard input (-) comming from ssh stream. Change (-C) to the desired remote folder before starting the process on the remote side. </p>
<p>This is, AFAIK, the best way to do the jobs. Just one step, super-fast, using compression if needed… what else?</p>
<p>Of course, you can also do it reverse, from server to your host:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh user@remoteHost &quot;tar -cvf - &#x2F;your&#x2F;remote&#x2F;folder&quot; | tar -xvf -</span><br></pre></td></tr></table></figure>

<p>You may even create a local tar file from remote files using this way:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh user@remoteHost &quot;tar -cvf - &#x2F;your&#x2F;remote&#x2F;folder&quot; &gt; local.file.tgz</span><br></pre></td></tr></table></figure>


<p>Cool, isn’t it?</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jmiguelr.github.io/2019/06/07/Copy-thousand-of-files-over-ssh/" data-id="ckjfn7ck60008wqd9fbg86i3c" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/eng/" rel="tag">eng</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Setting-default-Linux-kernel" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/05/20/Setting-default-Linux-kernel/" class="article-date">
  <time datetime="2019-05-20T14:34:12.000Z" itemprop="datePublished">2019-05-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/05/20/Setting-default-Linux-kernel/">Setting default Linux kernel</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Sometimes we want to boot Linux with a older kernel than default. If it’s just one time, it’s a piece of cake to select it on the boot menu.</p>
<p>Things starts to get a bit worse if you need to boot everytime with a previous version because (as it’s my case right now) you suspect there’s something that could affect performance or stability but you’re not sure.</p>
<p>The best suited for my needs it’s telling <code>grub2</code> to remember the last kernel used. To do this you have to follow this steps:</p>
<ul>
<li>Keep a copy of <code>grub</code> file.  Just in case…</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp &#x2F;etc&#x2F;default&#x2F;grub &#x2F;etc&#x2F;default&#x2F;grub.bak</span><br></pre></td></tr></table></figure>

<ul>
<li>Edit it with your favourite editor: vi, emacs, nano, joe …</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo joe &#x2F;etc&#x2F;default&#x2F;grub</span><br></pre></td></tr></table></figure>

<p>and change the default behaviour <code>GRUB_DEFAULT=0</code> which cause grub to choose the latest kernel with:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GRUB_DEFAULT&#x3D;saved</span><br><span class="line">GRUB_SAVEDEFAULT&#x3D;true</span><br></pre></td></tr></table></figure>

<ul>
<li>Update grub with <code>sudo update-grub</code></li>
</ul>
<p>Done!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jmiguelr.github.io/2019/05/20/Setting-default-Linux-kernel/" data-id="ckjfn7ckf000mwqd92dwu996x" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/eng/" rel="tag">eng</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Changing-hostname-on-Ubuntu-18-04-Server" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/25/Changing-hostname-on-Ubuntu-18-04-Server/" class="article-date">
  <time datetime="2019-04-25T11:18:50.000Z" itemprop="datePublished">2019-04-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/25/Changing-hostname-on-Ubuntu-18-04-Server/">Changing hostname on Ubuntu 18.04 Server</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Coming from previous versions of Ubuntu, I’m getting some issues with the new configuration system on Ubuntu 18.04. Not sure if some of them are welcomed (to me) but…  they are there so we have no option.</p>
<p>Few moments ago, I’ve installed a new server with Ubuntu 18 and, thinking in future, I’ve created a blueprint on VMWare I could reuse for new servers. So I’ve create a new server with basic funcionalities, upgrade it and then convert to blueprint. Obviously, I gave it a nonsense name as <em>ubuntu18</em></p>
<p>After that, I created a virtual machine from blueprint and, you guess it, I tried to change the name.</p>
<p>On previous versiones, I just needed to change it on <code>/etc/hosts</code> and <code>/etc/hostname</code> . That’s all. But now we need an aditional step.  You need to change on <code>/etc/cloud/cloud.cfg</code> and tell you don’t want to upgrade the hostname (I could find where it finds the original name) on every reboot. The parameter is <code>preserve_hostname</code> and you need to change the default <code>false</code> value to <code>true</code></p>
<p>So all steps:</p>
<ul>
<li>Edit <code>/etc/cloud/cloud.cfg</code> and change <code>preserve_hostname: false</code> to <code>preserve_hostname: true</code></li>
<li>Edit <code>/etc/hostname</code> and <code>/etc/hosts</code> .  On <code>hostname</code> file, just put your new name. On <code>/etc/hosts</code>, add a line like <code>127.0.1.1 myHostName</code> and <code>x.x.x.x myHostName</code> where <code>x.x.x.x</code> it’s your real IP name (if static)</li>
</ul>
<p>That’s all!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jmiguelr.github.io/2019/04/25/Changing-hostname-on-Ubuntu-18-04-Server/" data-id="ckjfn7ck00003wqd90oe5gie1" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/eng/" rel="tag">eng</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/linux/" rel="tag">linux</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-Setting-clock-on-ESXi-console" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/04/25/Setting-clock-on-ESXi-console/" class="article-date">
  <time datetime="2019-04-25T09:28:17.000Z" itemprop="datePublished">2019-04-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/04/25/Setting-clock-on-ESXi-console/">Setting clock on ESXi console</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Today I realized one of my ESXi servers had system clock way long in the future. It has no internet access so I cannot simply update it with any of the multiple time servers around the world. I thought it was just a matter of simply do a <code>date -s</code> … but on ESXi console things are not usually so simpler.</p>
<p>The right way to change time on console involves two commands, one for current date and another for setting the hardware clock so you get the right date again after reboot.  Commands are:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># esxcli system time set -?</span><br><span class="line">Usage: esxcli system time set [cmd options]</span><br><span class="line"></span><br><span class="line">Description:</span><br><span class="line">  set                   Set the system clock time. Any missing parameters will default to the current time</span><br><span class="line"></span><br><span class="line">Cmd options:</span><br><span class="line">  -d|--day&#x3D;&lt;long&gt;       Day</span><br><span class="line">  -H|--hour&#x3D;&lt;long&gt;      Hour</span><br><span class="line">  -m|--min&#x3D;&lt;long&gt;       Minute</span><br><span class="line">  -M|--month&#x3D;&lt;long&gt;     Month</span><br><span class="line">  -s|--sec&#x3D;&lt;long&gt;       Second</span><br><span class="line">  -y|--year&#x3D;&lt;long&gt;      Year</span><br></pre></td></tr></table></figure>

<p>and</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">esxcli hardware clock set -?</span><br></pre></td></tr></table></figure>

<p>with the same format as above.</p>
<p>Note the <code>Any missing parameters will default to the current time</code>, I assume seconds go to zero when setting minutes, but it’s not the case here.</p>
<p>So, if you want to set time to 09:10:00 , current date, the right commands are:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># esxcli system time set -H 09 -m 10 -s 00  ; esxcli hardware clock set -H 09 -m 10 -s 00</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://jmiguelr.github.io/2019/04/25/Setting-clock-on-ESXi-console/" data-id="ckjfn7ckb000fwqd94my01hdv" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/eng/" rel="tag">eng</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/esxi/" rel="tag">esxi</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vmware/" rel="tag">vmware</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-The-fastest-way-to-count-columns-in-shell-AWK" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2019/02/03/The-fastest-way-to-count-columns-in-shell-AWK/" class="article-date">
  <time datetime="2019-02-03T16:10:24.000Z" itemprop="datePublished">2019-02-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2019/02/03/The-fastest-way-to-count-columns-in-shell-AWK/">The fastest way to count columns in shell: AWK</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Say you have (as I do) a file <code>/tmp/myFile.txt</code> containing a list of unrelated folders with their size, as follows:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">7220    X03066659D&#x2F;txt&#x2F;20150109</span><br><span class="line">1365    A30266659D&#x2F;txt&#x2F;20150112</span><br><span class="line">9       X30626659D&#x2F;txt&#x2F;20150121</span><br><span class="line">0       X30663659D&#x2F;xml&#x2F;20150102</span><br><span class="line">5292    A30646659D&#x2F;xml&#x2F;20150105</span><br><span class="line">10872   X30Q66659D&#x2F;xml&#x2F;20150107</span><br><span class="line">7384    A30A66659D&#x2F;xml&#x2F;20150108</span><br></pre></td></tr></table></figure>

<p>And you want to sum the first column of every line to know the total. <strong>AWK</strong> at rescue!</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#39;&#123;sum +&#x3D; $1&#125; END &#123;print sum&#125; &#x2F;tmp&#x2F;myFile.txt&#39;</span><br></pre></td></tr></table></figure>

<p>If there were a discriminant you would like to use (imagine you only need those starting with <code>A</code> on second column) you can filter on AWK line (no need to grep)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#39;$2 ~ &#x2F;^A&#x2F; &#123;sum +&#x3D; $1&#125; END &#123;print sum&#125;&#39; &#x2F;tmp&#x2F;myFile.txt</span><br></pre></td></tr></table></figure>



      
    </div>
    <footer class="article-footer">
      <a data-url="http://jmiguelr.github.io/2019/02/03/The-fastest-way-to-count-columns-in-shell-AWK/" data-id="ckjfn7cki000rwqd9ftp29aus" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/eng/" rel="tag">eng</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/" rel="tag">git</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/aws/" rel="tag">aws</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/eng/" rel="tag">eng</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/esp/" rel="tag">esp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/esxi/" rel="tag">esxi</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/general/" rel="tag">general</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html/" rel="tag">html</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vmware/" rel="tag">vmware</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/aws/" style="font-size: 10px;">aws</a> <a href="/tags/docker/" style="font-size: 10px;">docker</a> <a href="/tags/eng/" style="font-size: 20px;">eng</a> <a href="/tags/esp/" style="font-size: 10px;">esp</a> <a href="/tags/esxi/" style="font-size: 10px;">esxi</a> <a href="/tags/general/" style="font-size: 10px;">general</a> <a href="/tags/git/" style="font-size: 13.33px;">git</a> <a href="/tags/html/" style="font-size: 10px;">html</a> <a href="/tags/linux/" style="font-size: 16.67px;">linux</a> <a href="/tags/vmware/" style="font-size: 10px;">vmware</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/01/02/My-new-2FA-setup-Authy-oathtool/">My new 2FA setup - Authy + oathtool</a>
          </li>
        
          <li>
            <a href="/2020/01/19/Getting-Hyperfido-U2F-keys-working-on-Linux-Ubuntu-or-Mint/">Getting Hyperfido U2F keys working on Linux (Ubuntu or Mint)</a>
          </li>
        
          <li>
            <a href="/2019/09/13/Show-slow-queries-on-postgresql/">Show slow queries on postgresql</a>
          </li>
        
          <li>
            <a href="/2019/09/12/Add-a-new-ssh-authorized-key-to-a-remote-host-in-one-single-line/">Add a new ssh authorized key to a remote host... in one single line</a>
          </li>
        
          <li>
            <a href="/2019/06/19/Rename-multiple-files-with-a-given-pattern/">Rename multiple files with a given pattern</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 jmiguel rodriguez<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="https://www.jmiguel.eu" target="_blank" rel="noopener" class="mobile-nav-link">jmiguel.eu</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>